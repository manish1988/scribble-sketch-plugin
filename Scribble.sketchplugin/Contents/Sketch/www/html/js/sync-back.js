var artboardSizes=[],totalArtboardsForSync=0,cfProgressBar=null,cfProgress=null,cfProgressFilled=null,cfProgressPercentage=null,cfProgressPercentageValue=null,selectedProjectName="",webViewInit=function(e){window.settings=e,window.webViewData=null,projects=[],$("#mainSection").addClass("active"),CheckUpdate(),connectRealtime(window.settings.cfURLSocket,window.settings.cfToken.userid),cfProgressBar=$("#cfProgressBar"),cfProgress=$("#cfProgress"),cfProgressFilled=$("#cfProgressFilled"),cfProgressPercentage=$("#cfProgressPercentage"),cfProgressPercentageValue=$("#cfProgressPercentageValue"),"true"==window.settings.isSyncAll?($("#syncAll").attr("checked","checked"),$("#syncSelected").attr("checked",!1)):($("#syncAll").attr("checked",!1),$("#syncSelected").attr("checked","checked")),$.ajax({url:window.settings.cfURLPrefix+"/vi/svcs/scribble/sketch/sketchGetProjects.php",data:{id:window.settings.cfToken.userid,token:window.settings.cfToken.token},type:"POST",cache:!1,dataType:"json",success:function(e){"success"==e.result&&loadProjects(e.projects)},error:function(e){},fail:function(e){}}),$("#syncBtn").on("click",function(){var e=$(this);e.attr("disabled",!0),e.removeClass("active"),selectedProjectName=$("#selectProject option:selected").text(),window.webViewData=encodeURI(JSON.stringify({projectId:parseInt($("#selectProject").val()),projectName:$("#selectProject option:selected").text(),isSyncAll:$("input[name='isSyncAll']:checked").val()})),window.location.hash="sync-back-init",window.location.hash=""}),$("#logoutBtn").on("click",function(){$("body > div").removeClass("active"),$("#loadSection").addClass("active"),window.location.hash="logout",window.location.hash=""}),$("#goToPreview").on("click",function(){var e=$(this).attr("data-href");window.webViewData=encodeURI(JSON.stringify({projectLink:e})),window.location.hash="go-to-preview",window.location.hash=""}),$("#getLatestPlugin").on("click",function(){window.location.hash="get-latest-plugin",window.location.hash=""})},loadProjects=function(e){for(var t="",o=0;o<e.length;o++){var r=!1;e[o].id==window.settings.projectId&&(r=!0),t+="<option value='"+e[o].id+"' data-html='<span>"+e[o].title+"</span>'"+(r?" selected='selected'":"")+">"+e[o].title+"</option>"}$("#selectProjectLoading").hide(),$("#selectProject").html(t),$("#selectProject").show(),$("#syncBtn").removeAttr("disabled"),$("#selectProject").dropdown({optionClass:"withripple",renderHtml:!0,onSelected:function(e){}})},SyncBackArtboard=function(e,t,o,r,s){window.webViewData=encodeURI(JSON.stringify({projectId:e,isSyncAll:t,projectUUID:o,pageUUID:r,artboards:s})),window.location.hash="sync-back-start",window.location.hash=""},ActivateSyncButton=function(e){$("#syncBtn").removeAttr("disabled").addClass("active")},SyncBackArtboardInit=function(e){e.artboards=e.artboards.split(","),cfProgressBar.addClass("active"),cfProgressFilled.width(0),cfProgressPercentageValue.text(0),totalArtboardsForSync=e.artboards.length,artboardSizes=[],startSync(e.projectId),$.ajax({url:window.settings.cfURLPrefix+"/vi/svcs/scribble/sketch/sketchSyncBackArtboards.php",data:{artboards:e.artboards,user_id:e.userId,user_token:e.token,project_id:e.projectId,is_sync_all:e.isSyncAll},type:"POST",cache:!1,dataType:"json",xhr:function(){var t=new window.XMLHttpRequest;return t.upload.addEventListener("progress",function(t){t.lengthComputable&&CalculateProgress(t.loaded,t.total,e.filename)},!1),t},success:function(t){"success"==t.result&&specsGenerationNotify(t),SyncBackArtboard(e.projectId,e.isSyncAll,t.project_uuid,t.page_uuid,t.artboards)},error:function(t){SyncBackArtboardProgressComplete(e.projectId,e.isSyncAll,"","")},fail:function(t){SyncBackArtboardProgressComplete(e.projectId,e.isSyncAll,"","")}})},SyncBackArtboardProgress=function(e,t,o,r){0==--totalArtboardsForSync&&SyncBackArtboardProgressComplete(e,t,o,r)},SyncBackArtboardProgressComplete=function(e,t,o,r){artboardSizes=[],$("#syncBtn").removeAttr("disabled").addClass("active"),cfProgressBar.removeClass("active"),cfProgressFilled.width(0),cfProgressPercentageValue.text(0);var s=window.settings.cfURLPrefix;s+="true"==t?"/vi/share/?project="+o:"/vi/scribble/?page="+r,$("#completeSection textarea").text(s),$("#goToPreview").attr("data-href",s),$(".page").removeClass("active"),$("#completeSection").addClass("active"),endSync(e)},CalculateProgress=function(e,t,o){for(var r=0,s=0,c=!1,a=0;a<artboardSizes.length;a++)artboardSizes[a].filename==o&&(artboardSizes[a].uploaded=e),c=!0,s+=artboardSizes[a].size,r+=artboardSizes[a].uploaded;c||(artboardSizes.push({uploaded:e,size:t,filename:o}),s+=t,r+=e);var n=r/s*100;n=parseInt(n),cfProgressFilled.width(n/100*240),cfProgressPercentageValue.text(n)};